"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3571],{8829:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var r=t(4848),s=t(8453);const i={sidebar_label:"Hi!",sidebar_position:4},a="\u7b80\u4ecb",c={id:"config_center_demo",title:"\u7b80\u4ecb",description:"configcenterdemo \u662f\u4e00\u4e2a\u914d\u7f6e\u4e2d\u5fc3\u7684 C Clientdemo\uff0c\u4e3b\u8981\u529f\u80fd\u5305\u62ec\uff1a\u767b\u5165\u5f85\u79d8\u94a5\u8d26\u6237\uff0c\u4e3b\u52a8\u66f4\u65b0\u6216\u88ab\u52a8\u66f4\u65b0\u914d\u7f6e\u3002",source:"@site/docs/config_center_demo.md",sourceDirName:".",slug:"/config_center_demo",permalink:"/docs/config_center_demo",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/config_center_demo.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_label:"Hi!",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Translate your site",permalink:"/docs/tutorial-extras/translate-your-site"},next:{title:"Hi!",permalink:"/docs/hello"}},o={},l=[{value:"\u7ebf\u7a0b\u51fd\u6570Api \u66ff\u6362",id:"\u7ebf\u7a0b\u51fd\u6570api-\u66ff\u6362",level:2},{value:"\u9884\u5b9a\u4e49\u5b8f\u503c\u66ff\u6362",id:"\u9884\u5b9a\u4e49\u5b8f\u503c\u66ff\u6362",level:2},{value:"apollo_env \u7ed3\u6784\u65b0\u589e\u6210\u5458",id:"apollo_env-\u7ed3\u6784\u65b0\u589e\u6210\u5458",level:2},{value:"\u51fd\u6570 getNoCachePropertyString \u5185\u53c2\u6570\u9002\u914d",id:"\u51fd\u6570-getnocachepropertystring-\u5185\u53c2\u6570\u9002\u914d",level:2},{value:"\u51fd\u6570 checkNotifications \u5185\u53c2\u6570\u9002\u914d",id:"\u51fd\u6570-checknotifications-\u5185\u53c2\u6570\u9002\u914d",level:2},{value:"\u51fd\u6570 submitNotifications \u5185\u53c2\u6570\u9002\u914d",id:"\u51fd\u6570-submitnotifications-\u5185\u53c2\u6570\u9002\u914d",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u7b80\u4ecb",children:"\u7b80\u4ecb"})}),"\n",(0,r.jsx)(n.p,{children:"config_center_demo \u662f\u4e00\u4e2a\u914d\u7f6e\u4e2d\u5fc3\u7684 C Clientdemo\uff0c\u4e3b\u8981\u529f\u80fd\u5305\u62ec\uff1a\u767b\u5165\u5f85\u79d8\u94a5\u8d26\u6237\uff0c\u4e3b\u52a8\u66f4\u65b0\u6216\u88ab\u52a8\u66f4\u65b0\u914d\u7f6e\u3002"}),"\n",(0,r.jsx)(n.h1,{id:"\u9879\u76ee\u642d\u5efa",children:"\u9879\u76ee\u642d\u5efa"}),"\n",(0,r.jsx)(n.p,{children:'\u4e0b\u8f7d Apollo C  \u5ba2\u6237\u7aef\u4ee3\u7801\uff0c \u96c6\u6210json-c\u5e93\u6e90\u7801\uff0c\u96c6\u6210 Curl OpenSSL\u3002\n\u9879\u76ee\u914d\u7f6e\u9879: "\u5c06\u8b66\u544a\u89c6\u4e3a\u9519\u8bef" \u8bbe\u7f6e\u6210 "\u5426"\u3002'}),"\n",(0,r.jsx)(n.h1,{id:"\u53c2\u8003",children:"\u53c2\u8003"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://www.apolloconfig.com/#/zh/client/c-sdks-user-guide?id=apollo-c-%e5%ae%a2%e6%88%b7%e7%ab%af",children:"Apollo C \u5ba2\u6237\u7aef"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://www.apolloconfig.com/#/zh/client/other-language-client-user-guide",children:"http api \u63a5\u5165\u6307\u5357"})}),"\n",(0,r.jsx)(n.h1,{id:"\u9047\u5230\u7684\u95ee\u9898",children:"\u9047\u5230\u7684\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"1.c c++ \u4ee3\u7801\u6df7\u5408\u7f16\u8bd1\u62a5\u9519"}),"\n",(0,r.jsx)(n.h1,{id:"\u8d26\u53f7\u4fe1\u606f",children:"\u8d26\u53f7\u4fe1\u606f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'AppID:          "Reiboot",\nCluster:        "test",\nIP:             "https://apollo-test.afirstsoft.cn:8443",\nNamespaceName:  "tsbd",\nSecret:         "3732d6825d7849978e26d2f4d09a578e",\n'})}),"\n",(0,r.jsx)(n.h1,{id:"apolloclienth-\u6587\u4ef6\u4fee\u6539",children:"apolloclient.h \u6587\u4ef6\u4fee\u6539"}),"\n",(0,r.jsx)(n.h2,{id:"\u7ebf\u7a0b\u51fd\u6570api-\u66ff\u6362",children:"\u7ebf\u7a0b\u51fd\u6570Api \u66ff\u6362"}),"\n",(0,r.jsx)(n.p,{children:"pthread_createv \u7ebf\u7a0b\u65b9\u6cd5\u66ff\u6362\u6210Windows Api_beginthread\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u9884\u5b9a\u4e49\u5b8f\u503c\u66ff\u6362",children:"\u9884\u5b9a\u4e49\u5b8f\u503c\u66ff\u6362"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'#define APOLLO_CONFIG_NOCACHE_URL "%s/configs/%s/%s/%s"\n#define APOLLO_CONFIG_NOTI_URL "%s/notifications/v2?appId=%s&cluster=%s&notifications=%s"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"apollo_env-\u7ed3\u6784\u65b0\u589e\u6210\u5458",children:"apollo_env \u7ed3\u6784\u65b0\u589e\u6210\u5458"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"typedef struct {\n\t\tString meta; //apollometa\u670d\u52a1\u5668ip\u548c\u5730\u5740\n\t\tString appId;//\u5e94\u7528\u540d\u79f0,\u6bd4\u5982\u7f51\u5173gateway\n\t\tString clusterName;//\u96c6\u7fa4\u540d\u79f0\uff0c\u9ed8\u8ba4default\n\t\tString namespaceName;//\u547d\u540d\u7a7a\u95f4\u540d\u79f0 \u5982application.ymal\n\t\tString secret;\n\t\t//String sign;\n\t\t//String timestamp;\n\t} apollo_env;\n"})}),"\n",(0,r.jsx)(n.h1,{id:"apollo_clientc-\u6587\u4ef6\u4fee\u6539",children:"apollo_client.c \u6587\u4ef6\u4fee\u6539"}),"\n",(0,r.jsx)(n.h2,{id:"\u51fd\u6570-getnocachepropertystring-\u5185\u53c2\u6570\u9002\u914d",children:"\u51fd\u6570 getNoCachePropertyString \u5185\u53c2\u6570\u9002\u914d"}),"\n",(0,r.jsx)(n.p,{children:"\u8bbe\u7f6ecurl \u901a\u7528 header \u5934\u4fe1\u606f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'void* timestampHandle = createTimeStamp();\nchar* timestamp = getHandleString(timestampHandle);\nvoid* pathWithQueryHandle = CreatePathWithQuery(urlDest, apolloEnv.meta);\nchar* pathWithQuery = getHandleString(pathWithQueryHandle);\nvoid* strToSignHandle = StrToSign(timestamp, pathWithQuery);\nvoid* signHandle = createSign(getHandleString(strToSignHandle), apolloEnv.secret);\nchar* sign = getHandleString(signHandle);\nString tokenHeader = sprintfStr("Apollo %s:%s", apolloEnv.appId, sign);\nstruct curl_slist *headers =setCommonHeader(&res, tokenHeader, timestamp);\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5ffd\u7565ssl \u9a8c\u8bc1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"curl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, 0L);\ncurl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, 0L);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u51fd\u6570-checknotifications-\u5185\u53c2\u6570\u9002\u914d",children:"\u51fd\u6570 checkNotifications \u5185\u53c2\u6570\u9002\u914d"}),"\n",(0,r.jsx)(n.p,{children:"\u8bbe\u7f6ecurl \u901a\u7528 header \u5934\u4fe1\u606f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'void* timestampHandle = createTimeStamp();\nchar* timestamp = getHandleString(timestampHandle);\nvoid* pathWithQueryHandle = CreatePathWithQuery(urlDest, apolloEnv.meta);\nchar* pathWithQuery = getHandleString(pathWithQueryHandle);\nvoid* strToSignHandle = StrToSign(timestamp, pathWithQuery);\nvoid* signHandle = createSign(getHandleString(strToSignHandle), apolloEnv.secret);\nchar* sign = getHandleString(signHandle);\nString tokenHeader = sprintfStr("Apollo %s:%s", apolloEnv.appId, sign);\nstruct curl_slist *headers =setCommonHeader(&res, tokenHeader, timestamp);\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5ffd\u7565ssl \u9a8c\u8bc1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"curl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, 0L);\ncurl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, 0L);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u51fd\u6570-submitnotifications-\u5185\u53c2\u6570\u9002\u914d",children:"\u51fd\u6570 submitNotifications \u5185\u53c2\u6570\u9002\u914d"}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e00\u6b21\u83b7\u53d6\u8d44\u6e90\u4fe1\u606f\u5206\u914d\u5185\u5b58"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"//Properties oldProperties;\nProperties *poldProperties = NULL;\npoldProperties = (Properties*)malloc(sizeof(Properties));\ngetNoCacheProperty(apolloEnv,poldProperties);\ncallback(NULL, poldProperties);\nlong responseCode;\nString notiStr=newString(1000);\nmemset(notiStr, 0, 1000);\n//Properties newProperties;\nProperties *pnewProperties = (Properties*)malloc(sizeof(Properties));\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"*poldProperties =*pnewProperties;\n//                    newProperties.len=0;\n//                    free(newProperties.keys);\n//                    free(newProperties.values);\n"})}),"\n",(0,r.jsx)(n.h1,{id:"\u79d8\u94a5\u52a0\u5bc6\u5904\u7406",children:"\u79d8\u94a5\u52a0\u5bc6\u5904\u7406"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",metastring:"HmacSha1Utils.cpp",children:'std::string base64_encode(const std::string &input) {\n\tBIO *bio, *b64;\n\tBUF_MEM *bufferPtr;\n\n\tb64 = BIO_new(BIO_f_base64());\n\tbio = BIO_new(BIO_s_mem());\n\tbio = BIO_push(b64, bio);\n\n\tBIO_set_flags(bio, BIO_FLAGS_BASE64_NO_NL); // Ignore newlines - write everything in one line\n\tBIO_write(bio, input.c_str(), input.length());\n\tBIO_flush(bio);\n\tBIO_get_mem_ptr(bio, &bufferPtr);\n\tstd::string output(bufferPtr->data, bufferPtr->length);\n\tBIO_free_all(bio);\n\n\treturn output;\n}\n\nstd::string hmac_sha1(const std::string &key, const std::string &data) {\n\tunsigned char* result;\n\tunsigned int result_len;\n\n\tresult = HMAC(EVP_sha1(), key.c_str(), key.length(), (unsigned char*)data.c_str(), data.length(), NULL, &result_len);\n\tif (result == NULL) {\n\t\tthrow std::runtime_error("HMAC calculation failed");\n\t}\n\n\treturn std::string((char*)result, result_len);\n}\n\nstd::string signString(const std::string &stringToSign, const std::string &accessKeySecret) {\n\tstd::string hmacResult = hmac_sha1(accessKeySecret, stringToSign);\n\treturn base64_encode(hmacResult);\n}\n'})}),"\n",(0,r.jsx)(n.h1,{id:"\u65e5\u671f\u8f6c\u65f6\u95f4\u6233",children:"\u65e5\u671f\u8f6c\u65f6\u95f4\u6233"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",metastring:"title=SignInfoWraper.cpp",children:'// \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b57\u7b26\u4e32\nvoid* createTimeStamp()\n{\n\treturn new std::string(GetCurTimeStamp());\n}\n\n\nvoid* createSign(const char* strToSign, const char* secret)\n{\n\treturn new std::string(signString(strToSign, secret));\n}\n// \u83b7\u53d6\u5b57\u7b26\u4e32\u5185\u5bb9\nconst char* getHandleString(void* handle)\n{\n\tstd::string* str = static_cast<std::string*>(handle);\n\treturn str->c_str(); // \u8fd4\u56de C \u98ce\u683c\u7684\u5b57\u7b26\u4e32\u6307\u9488\n}\n// \u9500\u6bc1\u5b57\u7b26\u4e32\u5bf9\u8c61\nvoid destroyHandle(void* handle)\n{\n\tstd::string* str = static_cast<std::string*>(handle);\n\tdelete str; // \u91ca\u653e std::string \u5bf9\u8c61\u7684\u5185\u5b58\n}\n\nvoid* CreatePathWithQuery(const char* urlDest, const char* server)\n{\n\tstd::string strUrlDest(urlDest);\n\tstd::string strServer(server);\n\tstd::size_t nSize = strUrlDest.find_first_of(strServer);\n\tstd::string substr = nSize >= 0 ? strUrlDest.substr(nSize + strServer.size()) : "";\n\treturn new std::string(substr);\n}\n\nvoid* StrToSign(const char* timestamp, const char* pathWithQuery)\n{\n\tstd::string strTimestamp(timestamp);\n\tstd::string strPathWithQuery(pathWithQuery);\n\n\treturn new std::string(strTimestamp + "\\n" + strPathWithQuery);//"your string to sign";\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",metastring:"title=SignInfo.cpp",children:"// \u8f85\u52a9\u51fd\u6570\uff1a\u5c06FILETIME\u8f6c\u6362\u4e3a\u6beb\u79d2  \nuint64_t FileTimeToMillisecondsSinceEpoch(const FILETIME& ft) {\n\t// FILETIME\u662f\u81ea1601\u5e741\u67081\u65e5\u4ee5\u6765\u7684100\u7eb3\u79d2\u95f4\u9694\u6570  \n\t// \u9996\u5148\u8f6c\u6362\u4e3a\u81ea1601\u5e741\u67081\u65e5\u4ee5\u6765\u7684\u79d2\u6570  \n\tULARGE_INTEGER uli;\n\tuli.LowPart = ft.dwLowDateTime;\n\tuli.HighPart = ft.dwHighDateTime;\n\n\t// Windows\u7684epoch\u662f1601\u5e741\u67081\u65e5\uff0cUnix\u7684epoch\u662f1970\u5e741\u67081\u65e5  \n\t// \u4e24\u8005\u76f8\u5dee\u7684\u79d2\u6570\u4e3a\uff1a(1970 - 1601) * 365 * 24 * 60 * 60 = 11644473600  \n\t// \u6ce8\u610f\uff1a\u8fd9\u91cc\u6ca1\u6709\u8003\u8651\u95f0\u79d2\u548c\u95f0\u5e74\uff0c\u4f46\u5bf9\u4e8e\u5927\u591a\u6570\u5e94\u7528\u6765\u8bf4\u5df2\u7ecf\u8db3\u591f\u7cbe\u786e  \n\tconst uint64_t epochDiff = 11644473600ULL;\n\n\t// \u5c06100\u7eb3\u79d2\u8f6c\u6362\u4e3a\u6beb\u79d2\uff0c\u7136\u540e\u52a0\u4e0aepoch\u5dee\u5f02\uff0c\u5f97\u5230\u7ed3\u679c  \n\treturn (uli.QuadPart / 10000) - epochDiff * 1000;\n}\n\nstd::string GetTimeStamp(uint64_t millisecondsSinceEpoch)\n{\n\treturn std::to_string(millisecondsSinceEpoch);\n}\n\nstd::string GetCurTimeStamp()\n{\n\tFILETIME ft;\n\tGetSystemTimeAsFileTime(&ft);\n\tuint64_t millisecondsSinceEpoch = FileTimeToMillisecondsSinceEpoch(ft);\n\tstd::string timestamp = std::to_string(millisecondsSinceEpoch);\n\treturn timestamp;\n}\n"})}),"\n",(0,r.jsx)(n.h1,{id:"\u542f\u52a8",children:"\u542f\u52a8"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",metastring:"title=apolloConfigWin32Demo.cpp",children:'\tconst char* AppID = "Reiboot";\n\tconst char* Cluster = "test";\n\tconst char* IP = "https://apollo-test.afirstsoft.cn:8443";\n\tconst char* NamespaceName = "test";\n\tconst char* Secret = "3732d6825d7849978e26d2f4d09a578e";\n\n    apollo_env env;\n\tenv.meta = new char[100];\n\tenv.appId = new char[100];\n\tenv.clusterName = new char[100];\n\tenv.namespaceName = new char[100];\n\tenv.secret = new char[100];\n\tmemset(env.meta, 0, 100);\n\tmemcpy(env.meta, IP, strlen(IP) * sizeof(char));\n\tmemset(env.appId, 0, 100);\n\tmemcpy(env.appId, AppID, strlen(AppID) * sizeof(char));\n\tmemset(env.clusterName, 0, 100);\n\tmemcpy(env.clusterName, Cluster, strlen(Cluster) * sizeof(char));\n\tmemset(env.namespaceName, 0, 100);\n\tmemcpy(env.namespaceName, NamespaceName, strlen(NamespaceName) * sizeof(char));\n\tmemset(env.secret, 0, 100);\n\tmemcpy(env.secret, Secret, strlen(Secret) * sizeof(char));\n\n#pragma region apollocclient api\n\tchar* p = getNoCachePropertyString(env);\n\tif(p) printf("\\n%s",p);\n\n\tProperties prop;\n\tgetNoCacheProperty(env, &prop);\n\t\n\tnotification notifi = {0};\n\tnotifi.namespaceName = new char[100];\n\tmemset(notifi.namespaceName, 0, 100);\n\tmemcpy(notifi.namespaceName, NamespaceName, strlen(NamespaceName) * sizeof(char));\n\tnotifi.notificationId = -1;\n\tint flag = 0;\n\t//submitNotifications(env, notifi, &flag, submitCallback);\n\tsubmitNotificationsAsync(env, notifi, &flag, submitCallback);\n#pragma endregion\n\n\n#pragma region apolloc api\n\n#pragma endregion\n\n\tSleep(1000 * 60 * 60);\n\n\tfree(env.appId);\n\tfree(env.clusterName);\n\tfree(env.meta);\n\tfree(env.namespaceName);\n\tfree(env.secret);\n'})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var r=t(6540);const s={},i=r.createContext(s);function a(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);